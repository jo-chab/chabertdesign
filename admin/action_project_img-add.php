<?php    include("../_includes/session_test.inc");    include("../_includes/chabertdesign.inc");        if ($_SERVER['REQUEST_METHOD'] === 'POST') {        $project = $_POST['element'];                // Check if selected_imgs is an array        if (isset($_POST['selected_imgs']) && is_array($_POST['selected_imgs'])) {            $selectedImgs = $_POST['selected_imgs'];                        // Get the currently selected images from the database            $stmt2 = $db->prepare('SELECT image_id FROM project_images WHERE project_id = ?');            $stmt2->execute([$project]);            $dbSelectedImgs = $stmt2->fetchAll(PDO::FETCH_COLUMN, 0);                        // Calculate images to insert (in form but not in the database)            $imagesToInsert = array_diff($selectedImgs, $dbSelectedImgs);                        // Calculate images to delete (in the database but not in the form)            $imagesToDelete = array_diff($dbSelectedImgs, $selectedImgs);                        // Prepare SQL statements            $stmtInsert = $db->prepare('INSERT INTO project_images (project_id, image_id) VALUES (?, ?)');            $stmtDelete = $db->prepare('DELETE FROM project_images WHERE project_id = ? AND image_id = ?');                        // Start a database transaction for atomicity            $db->beginTransaction();                        // Insert new records for images to insert            foreach ($imagesToInsert as $img) {                $execute = $stmtInsert->execute([$project, $img]);                                if (!$execute) {                    print_r($stmtInsert->errorInfo());                    retour_erreur_content(22, 204, 'project', $project);                }            }                        // Delete records for images to delete            foreach ($imagesToDelete as $img) {                $execute = $stmtDelete->execute([$project, $img]);                                if (!$execute) {                    print_r($stmtDelete->errorInfo());                    retour_erreur_content(22, 204, 'project', $project);                }            }                        // Commit the transaction if everything is successful            $db->commit();                        $stmt2->closeCursor();            $stmtInsert->closeCursor();            $stmtDelete->closeCursor();            retour_erreur_content(23, 203, 'project', $project);        } else {            retour_erreur_content(23, 8, 'project', $project);        }    }?>