<?php        include("../_includes/session_test.inc");    include("../_includes/chabertdesign.inc");    include("../_includes/_fileUpload.inc"); // Include the file with the handleFileUpload function    require_once '../vendor/ezyang/htmlpurifier/library/HTMLPurifier.auto.php'; // Include HTML Purifier        // Check if the required POST parameters are set    $requiredFields = ['zt_name', 'ta_desc', 'element'];        foreach ($requiredFields as $field) {        if (empty($_POST[$field])) {            retour_erreur(30, 7);        }    }        $element = $_POST['element'];    $zt_name = nl2br(stripslashes($_POST['zt_name']));        // Get the user-generated HTML content    $userHtml = $_POST['ta_desc'];        // Create an HTML Purifier configuration    $config = HTMLPurifier_Config::createDefault();    $purifier = new HTMLPurifier($config);        // Clean and sanitize the HTML content    $cleanHtml = $purifier->purify($userHtml);        // Query the database to get the current file paths    $stmt = $db->prepare("SELECT image FROM services WHERE id = ?");    $stmt->execute([$element]);    $currentFiles = $stmt->fetch();        // Define the valid file extensions    $extensions_valides = ['jpg', 'jpeg', 'png'];    $page = '30';    $error_code = '1024';        $destination = $currentFiles['f_img']; // Initialize with the current image        // Check if a new image has been uploaded    if (!empty($_FILES['f_img']['size'])) {        // Delete the existing image if it exists        if (!empty($currentFiles['f_img'])) {            $fileToDelete = $_SERVER['DOCUMENT_ROOT'] . $currentFiles['f_img'];            if (file_exists($fileToDelete)) {                unlink($fileToDelete);            }        }                // Handle file upload for the new image        $dossier = "/assets/img/";        $destination = handleFileUpload($_FILES['f_img'], $dossier, $extensions_valides, $page, $error_code);    }        // Update the database with new file paths if an image was uploaded        if (!empty($_FILES['f_img']['size'])) {        $stmt2 = $db->prepare('UPDATE services SET name = ?, description = ?, image = ? WHERE id = ?');        $execute2 = $stmt2->execute([$zt_name, $cleanHtml, $destination, $element]);    }    else {        $stmt2 = $db->prepare('UPDATE services SET name = ?, description = ? WHERE id = ?');        $execute2 = $stmt2->execute([$zt_name, $cleanHtml, $element]);    }            if ($execute2) {        $stmt2->closeCursor();        retour_erreur(30, 3);    } else {        retour_erreur(30, 4);    }?>